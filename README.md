<p align="center">
  <img src="https://img.shields.io/badge/Python-3.10+-3776AB?style=for-the-badge&logo=python&logoColor=white" />
  <img src="https://img.shields.io/badge/LightGBM-ML%20Engine-9558B2?style=for-the-badge&logo=microsoft&logoColor=white" />
  <img src="https://img.shields.io/badge/Backtrader-Backtest-FF6F00?style=for-the-badge" />
  <img src="https://img.shields.io/badge/Tushare-Data%20Source-E74C3C?style=for-the-badge" />
</p>

<h1 align="center">ğŸ“ˆ å…¨å¸‚åœºè¡Œä¸šé¾™å¤´è½®åŠ¨é‡åŒ–ç­–ç•¥</h1>
<h3 align="center">Full-Market Sector Leader Rolling LightGBM Strategy</h3>

<p align="center">
  åŸºäº LightGBM æ»šåŠ¨è®­ç»ƒçš„ A è‚¡è¡Œä¸šé¾™å¤´è½®åŠ¨é‡åŒ–äº¤æ˜“ç³»ç»Ÿ<br/>
  è¦†ç›– <b>50+ è¡Œä¸š</b> Ã— <b>100+ A è‚¡æ ‡çš„</b> Â· è‡ªåŠ¨ç‰¹å¾å·¥ç¨‹ Â· Walk-Forward è®­ç»ƒ Â· å…¨é“¾è·¯å›æµ‹
</p>

---

Repository: https://github.com/rex-planck/lightgbm-sector-rotation


## âœ¨ é¡¹ç›®äº®ç‚¹

| æŒ‡æ ‡ | æ•°å€¼ |
|:---:|:---:|
| **æ€»æ”¶ç›Šç‡** | +447.63% |
| **å¹´åŒ–æ”¶ç›Š** | +33.45% |
| **Sharpe Ratio** | 1.756 |
| **æœ€å¤§å›æ’¤** | -31.27% |
| **Calmar Ratio** | 1.07 |
| **æŒä»“å æ¯”** | 94.8% |

> å›æµ‹åŒºé—´ï¼š2020-01-01 ~ 2026-02-18 Â· åˆå§‹èµ„é‡‘ 1000 ä¸‡ Â· å« A è‚¡ä½£é‡‘ + å°èŠ±ç¨

---

## ğŸ“ ç­–ç•¥æ¶æ„

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                     æ•°æ®å±‚ (Data Layer)                       â”‚
â”‚  Tushare Pro API â†’ æ—¥çº¿è¡Œæƒ… + å¤æƒå› å­ â†’ å‰å¤æƒ CSV          â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                           â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                  ç‰¹å¾å·¥ç¨‹å±‚ (Feature Layer)                    â”‚
â”‚  TA-Lib è®¡ç®— 25+ æŠ€æœ¯æŒ‡æ ‡ (RSI/MACD/ADX/Bollinger/OBV...)   â”‚
â”‚  + åŠ¨é‡ / æ³¢åŠ¨ç‡ / é‡ä»·èƒŒç¦» / Kçº¿å½¢æ€                         â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                           â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                 æœºå™¨å­¦ä¹ å±‚ (ML Layer)                         â”‚
â”‚  Rolling Walk-Forward LightGBM Classifier                   â”‚
â”‚  Â· 400æ—¥æ»šåŠ¨çª—å£ï¼Œæ¯20æ—¥é‡æ–°è®­ç»ƒ                               â”‚
â”‚  Â· æ—¶åºéªŒè¯ + Early Stopping é˜²è¿‡æ‹Ÿåˆ                         â”‚
â”‚  Â· 5æ—¥å‰ç»æ”¶ç›Š > 1% ä½œä¸ºæ ‡ç­¾                                  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                           â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                  å›æµ‹å±‚ (Backtest Layer)                      â”‚
â”‚  Backtrader å¼•æ“ Â· Cheat-on-Close æ¨¡å¼                      â”‚
â”‚  Â· Top-K æŒä»“ (K=2) Â· æ¦‚ç‡é˜ˆå€¼ â‰¥ 0.70                       â”‚
â”‚  Â· 8% å›ºå®šæ­¢æŸ Â· æœ€å°‘æŒä»“ 3 å¤©                                â”‚
â”‚  Â· A è‚¡ä½£é‡‘æ¨¡å‹ (ä¹° 0.03% / å– 0.03% + 0.1% å°èŠ±ç¨)          â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                           â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                  å¯è§†åŒ–å±‚ (Visualization)                     â”‚
â”‚  å‡€å€¼æ›²çº¿ Â· æ°´ä¸‹å›æ’¤ Â· æœˆåº¦çƒ­åŠ›å›¾ Â· ç»¼åˆæŠ¥å‘Š                   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## ğŸ—‚ï¸ é¡¹ç›®ç»“æ„

```
TESTING/
â”œâ”€â”€ main.py                 # ğŸš€ ä¸€é”®æ‰§è¡Œå…¥å£ï¼šä¸‹è½½ â†’ è®­ç»ƒ â†’ å›æµ‹
â”œâ”€â”€ config.py               # âš™ï¸ å…¨å±€é…ç½®ï¼šæ ‡çš„æ± ã€æ¨¡å‹å‚æ•°ã€è·¯å¾„
â”œâ”€â”€ data_loader.py          # ğŸ“¥ Tushare æ•°æ®ä¸‹è½½ä¸å‰å¤æƒå¤„ç†
â”œâ”€â”€ ml_strategy.py          # ğŸ§  Rolling LightGBM è®­ç»ƒ & Walk-Forward é¢„æµ‹
â”œâ”€â”€ backtest_engine.py      # ğŸ“Š Backtrader å›æµ‹å¼•æ“ (Phase 4 Strategy)
â”œâ”€â”€ charts.py               # ğŸ¨ å¯è§†åŒ–å›¾è¡¨ç”Ÿæˆ (å‡€å€¼/å›æ’¤/çƒ­åŠ›å›¾)
â”œâ”€â”€ grid_search.py          # ğŸ” ç½‘æ ¼æœç´¢ top_k Ã— threshold
â”œâ”€â”€ param_search.py         # ğŸ”§ é«˜æ•ˆå‚æ•°æœç´¢
â”œâ”€â”€ refine_search.py        # ğŸ¯ ç²¾ç»†å‚æ•°ä¼˜åŒ– (å« trailing stop)
â”œâ”€â”€ train_and_search.py     # ğŸ”„ è®­ç»ƒ + è‡ªé€‚åº”ç½‘æ ¼æœç´¢ pipeline
â”œâ”€â”€ run_final_backtest.py   # âœ… æœ€ç»ˆå›æµ‹ & è¾“å‡ºæ€»ç»“æŠ¥å‘Š
â”œâ”€â”€ requirements.txt        # ğŸ“¦ ä¾èµ–åˆ—è¡¨
â”œâ”€â”€ data/                   # ğŸ’¾ æœ¬åœ°Kçº¿ CSV æ•°æ® (100+ è‚¡ç¥¨)
â””â”€â”€ output/                 # ğŸ“ å›æµ‹è¾“å‡º (å›¾è¡¨/æŠ¥å‘Š/é¢„æµ‹æ–‡ä»¶)
    â”œâ”€â”€ phase4_report.png       # ç»¼åˆæŠ¥å‘Šå›¾
    â”œâ”€â”€ equity_curve.png        # å‡€å€¼æ›²çº¿
    â”œâ”€â”€ drawdown.png            # æ°´ä¸‹å›æ’¤æ›²çº¿
    â”œâ”€â”€ monthly_heatmap.png     # æœˆåº¦æ”¶ç›Šçƒ­åŠ›å›¾
    â”œâ”€â”€ predictions.pkl         # æ¨¡å‹é¢„æµ‹æ¦‚ç‡ (å…¨è‚¡ç¥¨)
    â”œâ”€â”€ final_backtest_summary.json  # å›æµ‹æŒ‡æ ‡æ±‡æ€»
    â””â”€â”€ pyfolio_*.csv           # PyFolio å…¼å®¹æ ¼å¼
```

---

## ğŸš€ å¿«é€Ÿå¼€å§‹

### 1. ç¯å¢ƒå‡†å¤‡

```bash
# å…‹éš†é¡¹ç›®
git clone <repo-url>
cd TESTING

# å®‰è£…ä¾èµ–
pip install -r requirements.txt

# TA-Lib éœ€è¦é¢å¤–å®‰è£…ï¼ˆWindows æ¨èä½¿ç”¨é¢„ç¼–è¯‘ whlï¼‰
# https://github.com/cgohlke/talib-build/releases
pip install TA-Lib
```

### 2. é…ç½® Tushare Token

åœ¨ `config.py` ä¸­è®¾ç½®ä½ çš„ Tushare Pro Tokenï¼š

```python
TS_TOKEN = "your_tushare_pro_token"
```

> ğŸ“Œ éœ€è¦ Tushare Pro æƒé™ã€‚æ³¨å†Œåœ°å€ï¼šhttps://tushare.pro/register

### 3. ä¸€é”®è¿è¡Œ

```bash
python main.py
```

è¿™å°†è‡ªåŠ¨æ‰§è¡Œå®Œæ•´ pipelineï¼š
1. **æ•°æ®ä¸‹è½½** â€” ä» Tushare æ‹‰å–è¡Œæƒ…æ•°æ®å¹¶å‰å¤æƒå¤„ç†
2. **æ¨¡å‹è®­ç»ƒ** â€” æ»šåŠ¨ Walk-Forward LightGBM é¢„æµ‹æ¦‚ç‡
3. **ç­–ç•¥å›æµ‹** â€” Backtrader å¼•æ“æ‰§è¡Œ Top-K è½®åŠ¨å›æµ‹
4. **è¾“å‡ºæŠ¥å‘Š** â€” ç”Ÿæˆå›¾è¡¨ã€CSV å’Œ JSON æ±‡æ€»

### 4. å‚æ•°ä¼˜åŒ–ï¼ˆå¯é€‰ï¼‰

```bash
# ä½¿ç”¨å·²æœ‰ predictions.pkl è¿›è¡Œç½‘æ ¼æœç´¢
python grid_search.py

# æˆ–ä¸€ä½“åŒ–è®­ç»ƒ + æœç´¢
python train_and_search.py

# ç²¾ç»†åŒ–æœç´¢ï¼ˆå« trailing stopï¼‰
python refine_search.py

# ä½¿ç”¨æœ€ä¼˜å‚æ•°é‡æ–°å›æµ‹
python run_final_backtest.py
```

---

## ğŸ§  æ ¸å¿ƒæŠ€æœ¯ç»†èŠ‚

### ç‰¹å¾å·¥ç¨‹ï¼ˆ25+ æŠ€æœ¯æŒ‡æ ‡ï¼‰

| ç±»åˆ« | ç‰¹å¾ | è¯´æ˜ |
|:---|:---|:---|
| **åŠ¨é‡** | RSI(5,14), ROC(5,10,20), MACD, MACD Histogram | ä»·æ ¼åŠ¨é‡ä¸è¶‹åŠ¿ |
| **è¶‹åŠ¿** | ADX(14), CCI(14), Williams %R, MFI(14) | è¶‹åŠ¿å¼ºåº¦ä¸è¶…ä¹°è¶…å– |
| **å‡çº¿** | SMA 5/20/60 æ¯”ç‡, ä»·æ ¼åç¦» MA20 | å‡çº¿ç³»ç»Ÿ |
| **æ³¢åŠ¨ç‡** | ATR(5,14) å½’ä¸€åŒ–, å¤šå‘¨æœŸæ”¶ç›Šç‡ | æ³¢åŠ¨ç‡ä¼°è®¡ |
| **å¸ƒæ—å¸¦** | BB Position (0~1) | ä»·æ ¼åœ¨å¸ƒæ—å¸¦ä¸­çš„ä½ç½® |
| **é‡ä»·** | é‡æ¯”(5æ—¥/20æ—¥), é‡ä»·ç›¸å…³ç³»æ•°(10æ—¥) | æˆäº¤é‡åŠ¨æ€ |
| **Kçº¿** | Body Ratio (-1~1) | Kçº¿å®ä½“å æ¯” |

### æ¨¡å‹è®­ç»ƒç­–ç•¥

- **æ»šåŠ¨çª—å£**ï¼š400 æ—¥å†å²æ•°æ®è®­ç»ƒï¼Œæ¯ 20 æ—¥é‡æ–°æ‹Ÿåˆ
- **æ ‡ç­¾å®šä¹‰**ï¼šæœªæ¥ 5 æ—¥æ”¶ç›Šç‡ > 1% ä¸ºæ­£ç±»
- **éªŒè¯æ–¹å¼**ï¼šæ—¶åº 80/20 åˆ’åˆ† + Early Stopping (20 rounds)
- **æ­£åˆ™åŒ–**ï¼šL1(0.1) + L2(1.0) + `class_weight="balanced"`

### é£æ§ä½“ç³»

| å‚æ•° | å€¼ | è¯´æ˜ |
|:---|:---:|:---|
| Top-K | 2 | æ¯æ—¥æœ€å¤šæŒæœ‰ 2 åªæœ€é«˜æ¦‚ç‡è‚¡ç¥¨ |
| æ¦‚ç‡é˜ˆå€¼ | 0.70 | é¢„æµ‹æ¦‚ç‡ â‰¥ 70% æ‰å…¥é€‰å€™é€‰æ±  |
| å›ºå®šæ­¢æŸ | 8% | æŒä»“è·Œç ´æˆæœ¬ 8% ç«‹å³æ­¢æŸ |
| æœ€å°‘æŒä»“ | 3 å¤© | é˜²æ­¢é¢‘ç¹æ¢æ‰‹ |
| ä»“ä½ç®¡ç† | 0.95 / K | ç­‰æƒåˆ†é…ï¼Œä¿ç•™ 5% ç°é‡‘ç¼“å†² |

---

## ğŸ“Š å›æµ‹ç»“æœå¯è§†åŒ–

### ç»¼åˆæŠ¥å‘Š

<p align="center">
  <img src="output/phase4_report.png" width="90%" alt="ç»¼åˆæŠ¥å‘Š" />
</p>

### å‡€å€¼æ›²çº¿

<p align="center">
  <img src="output/equity_curve.png" width="90%" alt="å‡€å€¼æ›²çº¿" />
</p>

### æœˆåº¦æ”¶ç›Šçƒ­åŠ›å›¾

<p align="center">
  <img src="output/monthly_heatmap.png" width="85%" alt="æœˆåº¦æ”¶ç›Šçƒ­åŠ›å›¾" />
</p>

---

## ğŸ“¦ ä¾èµ–

| åº“ | ç”¨é€” |
|:---|:---|
| `pandas` / `numpy` | æ•°æ®å¤„ç† |
| `lightgbm` | æ¢¯åº¦æå‡åˆ†ç±»å™¨ |
| `scikit-learn` | æœºå™¨å­¦ä¹ å·¥å…· |
| `backtrader` | å›æµ‹å¼•æ“ |
| `tushare` | A è‚¡æ•°æ®æº |
| `TA-Lib` | æŠ€æœ¯åˆ†ææŒ‡æ ‡ |
| `matplotlib` / `seaborn` | å¯è§†åŒ– |
| `joblib` | å¹¶è¡Œè®¡ç®— & åºåˆ—åŒ– |

---

## âš ï¸ å…è´£å£°æ˜

> æœ¬é¡¹ç›®ä»…ä¾›**å­¦ä¹ ç ”ç©¶**ä½¿ç”¨ï¼Œä¸æ„æˆä»»ä½•æŠ•èµ„å»ºè®®ã€‚
> 
> å›æµ‹ç»“æœåŸºäºå†å²æ•°æ®ï¼Œä¸ä»£è¡¨æœªæ¥è¡¨ç°ã€‚å®é™…äº¤æ˜“æ¶‰åŠæ»‘ç‚¹ã€æµåŠ¨æ€§é£é™©å’Œå¸‚åœºå†²å‡»æˆæœ¬ç­‰å› ç´ ï¼Œå¯èƒ½ä¸å›æµ‹ç»“æœå­˜åœ¨æ˜¾è‘—å·®å¼‚ã€‚
> 
> é‡åŒ–æŠ•èµ„å…·æœ‰é£é™©ï¼Œè¯·è°¨æ…å†³ç­–ã€‚

---

## ğŸ“„ License

æœ¬é¡¹ç›®é‡‡ç”¨ MIT License å¼€æºã€‚

---

<p align="center">
  <sub>Built with â¤ï¸ for quantitative research</sub>
</p>
