
<div align="center">
  <a href="./README_zh.md">ç®€ä½“ä¸­æ–‡</a> | 
  <a href="./README.md">English</a>
</div>

<br />

# ğŸ“ˆ AShare-Macro-Rotation: åŸºäºå®è§‚çŠ¶æ€è¯†åˆ«ä¸æµåŠ¨æ€§é©±åŠ¨çš„è¡Œä¸šè½®åŠ¨ç³»ç»Ÿ

![Python](https://img.shields.io/badge/Python-3.13-blue.svg)
![Strategy](https://img.shields.io/badge/Strategy-Macro%20Rotation-green.svg)
![Model](https://img.shields.io/badge/Model-HMM%20%2B%20LightGBM-orange.svg)
![License](https://img.shields.io/badge/License-MIT-lightgrey.svg)

> **"Don't Fight the Fed."** â€”â€” ä¸€ä¸ªç»“åˆäº†å®è§‚æµåŠ¨æ€§è§†è§’ (Top-Down) ä¸å¾®è§‚æœºå™¨å­¦ä¹ æ‹©æ—¶ (Bottom-Up) çš„ A è‚¡å…¨é“¾è·¯é‡åŒ–ç­–ç•¥æ¡†æ¶ã€‚

## ğŸ“– é¡¹ç›®ç®€ä»‹ (Introduction)

æœ¬é¡¹ç›®æ„å»ºäº†ä¸€ä¸ªé’ˆå¯¹ A è‚¡å¸‚åœºçš„**å¤šå±‚æ¬¡è¡Œä¸šè½®åŠ¨ä¸æ‹©æ—¶ç³»ç»Ÿ**ã€‚ä¸åŒäºä¼ ç»Ÿçš„å•å› å­ç­–ç•¥ï¼Œæœ¬æ¡†æ¶æ ¸å¿ƒåœ¨äºè§£å†³**"å› æ—¶åˆ¶å®œ"**çš„é—®é¢˜ï¼š
1.  åˆ©ç”¨ **HMM (éšé©¬å°”å¯å¤«æ¨¡å‹)** è¯†åˆ«å¸‚åœºå®è§‚çŠ¶æ€ï¼ˆç‰›/ç†Š/éœ‡è¡ï¼‰ã€‚
2.  å¼•å…¥ **å¤®è¡ŒæµåŠ¨æ€§è§†è§’ (M2-CPI å‰ªåˆ€å·®)** ä½œä¸ºè¶…çº§ä¿¡å·ï¼Œåœ¨æµåŠ¨æ€§æ³›æ»¥æ—¶å¼ºåˆ¶æ¥ç®¡ç­–ç•¥ï¼ˆOverrideï¼‰ã€‚
3.  åœ¨éœ‡è¡å¸‚ä¸­ä½¿ç”¨ **LightGBM** è¿›è¡Œéçº¿æ€§å¾®è§‚æ‹©æ—¶ã€‚

é€šè¿‡å¯¹åŠå¯¼ä½“ã€æ–°èƒ½æºã€åŒ»ç–—ã€ç™½é…’ç­‰å…¸å‹è¡Œä¸šçš„å…¨æ ·æœ¬å¤–å›æµ‹ï¼ˆ2020-2026ï¼‰ï¼Œç­–ç•¥å±•ç°äº†æå¼ºçš„**å±æœºè§„é¿èƒ½åŠ› (Tail Risk Avoidance)** å’Œ **Beta æ•è·èƒ½åŠ›**ã€‚

---

## ğŸ“Š æ ¸å¿ƒç»©æ•ˆ (Performance Highlights)

åŸºäº **2020.01 - 2026.01** çš„æ ·æœ¬å¤–å›æµ‹æ•°æ®ï¼ˆåŒ…å« 2022 å¹´ç†Šå¸‚ã€2024 å¹´å¤§è·ŒåŠ 2025 å¹´æµåŠ¨æ€§ç‰›å¸‚ï¼‰ï¼š

![å…¨è¡Œä¸šæ”¶ç›Šå¯¹æ¯”](./data/plots/batch_sector_comparison.png)

| è¡Œä¸šæ¿å— (Sector) | ç­–ç•¥æ”¶ç›Š (Return) | åŸºå‡†æ”¶ç›Š (Benchmark) | **è¶…é¢æ”¶ç›Š (Alpha)** | ç­–ç•¥ç‰¹ç‚¹ (Key Feature) |
| :--- | :---: | :---: | :---: | :--- |
| **ğŸ’Š åŒ»ç–—æœåŠ¡ (CXO)** | **+52.33%** | +27.81% | **+24.52%** | ğŸ“‰ **å®Œç¾é¿é™©**ï¼šåœ¨ 2021-2023 ç†Šå¸‚ä¸­ä¿æŒç©ºä»“ |
| **âš¡ æ–°èƒ½æº (å…‰ä¼)** | **+68.83%** | +51.93% | **+16.90%** | ğŸš€ **è¶‹åŠ¿è·Ÿéš**ï¼šæ•æ‰é«˜æ³¢åŠ¨èµ›é“çš„ Beta |
| **ğŸ’» åŠå¯¼ä½“ (èŠ¯ç‰‡)** | **+118.60%** | +110.30% | **+8.29%** | ğŸŒŠ **æµåŠ¨æ€§å…±æŒ¯**ï¼šç²¾å‡†è¯†åˆ« V å‹åè½¬ |
| **ğŸ· é…¿é…’è¡Œä¸š** | -9.08% | -9.29% | +0.20% | ğŸ›¡ï¸ **é˜²å¾¡å±æ€§**ï¼šä»·å€¼é£æ ¼ï¼Œå¯¹æµåŠ¨æ€§å› å­ä¸æ•æ„Ÿ |

---

## ğŸ§  ç­–ç•¥é€»è¾‘ (Methodology)

æœ¬ç­–ç•¥é‡‡ç”¨ **"ä¸‰å±‚ä¿¡å·æ¼æ–—" (Three-Layer Signal Funnel)** æœºåˆ¶ï¼š

### Layer 1: å®è§‚çŠ¶æ€è¯†åˆ« (Macro Regime - HMM)
åˆ©ç”¨ `GaussianHMM` å¯¹å¸‚åœºè¿›è¡Œæ— ç›‘ç£èšç±»ï¼Œè¯†åˆ«ä¸‰ç§éšçŠ¶æ€ï¼š

![HMMå¸‚åœºçŠ¶æ€è¯†åˆ«](./data/plots/hmm_market_regimes.png)

* **State 0 (Panic/Bear)**: é«˜æ³¢åŠ¨ + ä¸‹è¡Œè¶‹åŠ¿ $\rightarrow$ **å¼ºåˆ¶ç©ºä»“ (Risk Off)**ã€‚
* **State 1 (Oscillation)**: ä½æ³¢åŠ¨ + æ— åºéœ‡è¡ $\rightarrow$ **è¿›å…¥å¾®è§‚æ‹©æ—¶**ã€‚
* **State 2 (Bull/Rally)**: ç¨³å¥ä¸Šæ¶¨ $\rightarrow$ **æŒæœ‰ (Risk On)**ã€‚
* *è¾“å…¥ç‰¹å¾*: $LogReturn$, $Volatility_{20d}$, $LiquidityDiff$ã€‚

### Layer 2: æµåŠ¨æ€§æš´åŠ›æ¥ç®¡ (Liquidity Override)
**"å®ªæ³•çº§"è§„åˆ™**ï¼šå½“å®è§‚æµåŠ¨æ€§æå…¶å……è£•æ—¶ï¼Œå¿½ç•¥æ‰€æœ‰æŠ€æœ¯é¢è¶…ä¹°ä¿¡å·ã€‚
$$Signal_{Override} = (M2_{YoY} - CPI_{YoY} > 5.0\%) \land (Price > MA_{20})$$
* **é€»è¾‘**: A è‚¡æ˜¯å…¸å‹çš„èµ„é‡‘å¸‚ã€‚å½“å‰ªåˆ€å·® $>5.0$ ä¸”ä»·æ ¼ç«™ä¸Šæœˆçº¿ ($MA_{20}$)ï¼Œè§†ä¸º**æµåŠ¨æ€§é©±åŠ¨çš„ç–¯ç‰›**ï¼Œå¼ºåˆ¶æ»¡ä»“ã€‚

### Layer 3: å¾®è§‚æœºå™¨å­¦ä¹ æ‹©æ—¶ (Micro Timing - LightGBM)
ä»…åœ¨ **State 1 (éœ‡è¡å¸‚)** ä¸”æ— æµåŠ¨æ€§æ¥ç®¡æ—¶å¯ç”¨ã€‚
* ä½¿ç”¨ **LightGBM** é¢„æµ‹æ¬¡æ—¥æ¶¨è·Œã€‚
* *ç‰¹å¾å·¥ç¨‹*: RSI, MACD, é‡ä»·èƒŒç¦», å®è§‚äº¤äº’ç‰¹å¾ (`Macro_RSI_Interact`)ã€‚
* *é£æ§*: è®¾å®šé¢„æµ‹æ¦‚ç‡é˜ˆå€¼ $>0.52$ æ‰å¼€ä»“ï¼Œæé«˜èƒœç‡ã€‚

---

## ğŸ› ï¸ æŠ€æœ¯æ ˆä¸å·¥ç¨‹æ¶æ„ (Tech Stack)

* **æ•°æ®æµ (ETL)**: `AKShare` (EastMoney/Sina API) $\rightarrow$ `Pandas` æ¸…æ´— $\rightarrow$ CSV æŒä¹…åŒ–
* **å»ºæ¨¡ (Modeling)**:
    * `hmmlearn`: é«˜æ–¯éšé©¬å°”å¯å¤«æ¨¡å‹
    * `lightgbm`: æ¢¯åº¦æå‡å†³ç­–æ ‘ (GBDT)
    * `scikit-learn`: äº¤å‰éªŒè¯ä¸è¯„ä¼°
* **å›æµ‹ (Backtest)**: å‘é‡åŒ–å›æµ‹ (Vectorized Backtesting)
* **ç¯å¢ƒ (Env)**: Docker / Python 3.13

---

## ğŸ“‚ é¡¹ç›®ç»“æ„ (File Structure)

```text
AShare-Macro-Rotation/
â”œâ”€â”€ data/
â”‚   â”œâ”€â”€ raw/                 # åŸå§‹æ•°æ® (å®è§‚/è¡Œä¸šCSV)
â”‚   â”œâ”€â”€ processed/           # æ¸…æ´—åçš„å®½è¡¨ (Feature Matrix)
â”‚   â””â”€â”€ plots/               # å›æµ‹ç»“æœå›¾è¡¨ (.png)
â”œâ”€â”€ models/
â”‚   â”œâ”€â”€ hmm_regime.py        # HMM æ¨¡å‹è®­ç»ƒä¸çŠ¶æ€åˆ’åˆ†
â”‚   â””â”€â”€ lgbm/
â”‚       â””â”€â”€ lgbm_predict.py  # LightGBM å¾®è§‚æ‹©æ—¶æ¨¡å‹
â”œâ”€â”€ strategy/
â”‚   â”œâ”€â”€ final_composite_backtest.py # æ ¸å¿ƒç­–ç•¥é€»è¾‘å®ç°
â”‚   â”œâ”€â”€ batch_run.py         # å…¨è¡Œä¸šæ‰¹é‡å›æµ‹å¼•æ“
â”‚   â””â”€â”€ sector_strategy.py   # æ—©æœŸå•å› å­ç­–ç•¥åŸå‹
â”œâ”€â”€ data_loader.py           # æ•°æ®ä¸‹è½½ä¸æ›´æ–°è„šæœ¬
â”œâ”€â”€ data_processor.py        # æ•°æ®æ¸…æ´—ä¸ç‰¹å¾å¯¹é½è„šæœ¬
â”œâ”€â”€ Dockerfile               # å®¹å™¨åŒ–éƒ¨ç½²é…ç½®
â””â”€â”€ requirements.txt         # ä¾èµ–åº“åˆ—è¡¨

```

---

## ğŸš€ å¿«é€Ÿå¼€å§‹ (Quick Start)

### 1. ç¯å¢ƒå‡†å¤‡

```bash
# å…‹éš†é¡¹ç›®
git clone [https://github.com/YourUsername/AShare-Macro-Rotation.git](https://github.com/YourUsername/AShare-Macro-Rotation.git)
cd AShare-Macro-Rotation

# å®‰è£…ä¾èµ–
pip install -r requirements.txt

```

### 2. æ•°æ®æ›´æ–° (ETL)

ä» AKShare è·å–æœ€æ–°çš„å®è§‚æ•°æ®ï¼ˆCPI/M2ï¼‰å’Œè¡Œä¸šè¡Œæƒ…ï¼š

```bash
python data/data_loader.py
# è¾“å‡º: ğŸ‰ å…¨è¡Œä¸šæ•°æ®æ›´æ–°å®Œæˆï¼

```

### 3. æ•°æ®æ¸…æ´—ä¸ç‰¹å¾å·¥ç¨‹

å°†æœˆé¢‘å®è§‚æ•°æ®ä¸æ—¥é¢‘è¡Œæƒ…å¯¹é½ï¼Œç”Ÿæˆ HMM è¾“å…¥çŸ©é˜µï¼š

```bash
python data/data_processor.py

```

### 4. è®­ç»ƒ HMM å®è§‚æ¨¡å‹

è¯†åˆ«å½“å‰å¸‚åœºæ‰€å¤„çš„ç‰›ç†ŠçŠ¶æ€ï¼š

```bash
python models/hmm_regime.py
# è¾“å‡º: ç”Ÿæˆ hmm_signals.csv å’Œ çŠ¶æ€åˆ’åˆ†å›¾

```

### 5. æ‰§è¡Œå…¨è¡Œä¸šå›æµ‹ (The Grand Finale)

è¿è¡Œæ‰¹é‡å›æµ‹å¼•æ“ï¼Œç”Ÿæˆæœ€ç»ˆæˆ˜ç»©æ’è¡Œæ¦œï¼š

```bash
python strategy/batch_run.py

```

*æŸ¥çœ‹ç»“æœ*: æ‰“å¼€ `data/plots/batch_sector_comparison.png` æŸ¥çœ‹å…¨è¡Œä¸šå‡€å€¼å¯¹æ¯”å›¾ã€‚

---

## ğŸ“ˆ å…¸å‹æ¡ˆä¾‹åˆ†æ (Case Study)

### 2024å¹´ï¼šé¿é™© (Crash Avoidance)

* **å¸‚åœºè¡¨ç°**: æ²ªæ·±300 å•è¾¹ä¸‹è·Œã€‚
* **ç­–ç•¥è¡Œä¸º**: HMM è¯†åˆ«ä¸º `State 0` (Bear) æˆ– ä»·æ ¼è·Œç ´ `MA20`ã€‚
* **ç»“æœ**: **ç©ºä»“èººå¹³**ã€‚å‡€å€¼æ›²çº¿å‘ˆæ°´å¹³ç›´çº¿ï¼Œå®Œç¾èº²è¿‡å›æ’¤ã€‚

### 2025å¹´ï¼šè¿›æ”» (Liquidity Driven)

* **å¸‚åœºè¡¨ç°**: å¤®è¡Œæ”¾æ°´ï¼ŒM2-CPI å‰ªåˆ€å·®æ‰©å¤§è‡³ 8.4ï¼Œå¸‚åœº V å‹åè½¬ã€‚
* **ç­–ç•¥è¡Œä¸º**: è§¦å‘ **Layer 2 Override**ã€‚å°½ç®¡ HMM ä»å¯èƒ½æœ‰éœ‡è¡ä¿¡å·ï¼Œä½†ç­–ç•¥å¼ºåˆ¶æ»¡ä»“ã€‚
* **ç»“æœ**: **æ»¡ä»“åƒæ»¡ Beta**ã€‚å‡€å€¼æ›²çº¿ç´§è´´æŒ‡æ•°æš´æ¶¨ï¼Œæ‹’ç»è¸ç©ºã€‚

---

## ğŸ“ å¾…åŠäº‹é¡¹ (To-Do)

* [ ] æ¥å…¥å®ç›˜äº¤æ˜“æ¥å£ (QMT/XtQuant)
* [ ] å¢åŠ æ›´å¤šå®è§‚å› å­ (ç¤¾è/ç¾å€ºåˆ©ç‡)
* [ ] éƒ¨ç½²è‡³äº‘æœåŠ¡å™¨å¹¶é…ç½® Crontab æ¯æ—¥å®šæ—¶è¿è¡Œ

## ğŸ¤ è´¡çŒ®ä¸è”ç³»

æœ¬é¡¹ç›®ä¸ºé‡åŒ–ç ”ç©¶æ¼”ç¤ºé¡¹ç›®ï¼Œæ¬¢è¿ Issue å’Œ PRã€‚

**Author**: [Hongran WANG]

---

*Disclaimer: Investment involves risk. This project is for educational and research purposes only.*

```

```
